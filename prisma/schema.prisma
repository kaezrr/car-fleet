generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum RegistrationStatus {
    ACTIVE
    MAINTENANCE
    DECOMMISSIONED
}

model Fleet {
    id                 String    @id
    Vehicle            Vehicle[]
    totalVehicles      Int       @default(0)
    activeVehicles     Int       @default(0)
    lastDistanceDriven Int       @default(0)
    averageFuel        Int       @default(0)
}

model Vehicle {
    id            Int                @id
    manufacturer  String
    model         String
    owner         String
    registration  RegistrationStatus
    fleet         Fleet              @relation(fields: [fleetId], references: [id])
    fleetId       String
    VehicleStatus VehicleStatus[]
    Telemetry     Telemetry[]
    Alert         Alert[]
}

enum EngineStatus {
    ON
    OFF
    IDLE
}

model Telemetry {
    id             Int          @id @default(autoincrement())
    coordsLon      Int
    coordsLat      Int
    speed          Int
    engine         EngineStatus
    fuel           Int
    odometer       Int
    diagnosticCode Int?
    timestamp      DateTime
    vehicle        Vehicle      @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
    vehicleId      Int
}

model VehicleStatus {
    vehicleId    Int      @unique
    lastOdometer Int
    lastFuel     Int
    lastDriven   DateTime
    Vehicle      Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
}

enum AlertType {
    SPEED_VIOLATION
    FUEL_LOW
}

model Alert {
    id        Int       @id @default(autoincrement())
    vehicle   Vehicle   @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
    type      AlertType
    vehicleId Int
    timestamp DateTime
}
