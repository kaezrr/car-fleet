generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum RegistrationStatus {
    ACTIVE
    MAINTENANCE
    DECOMMISSIONED
}

model Fleet {
    id      String    @id
    Vehicle Vehicle[]
    Alerts  Alerts[]
}

model Vehicle {
    id            Int                @id
    manufacturer  String
    model         String
    owner         String
    registration  RegistrationStatus
    fleet         Fleet              @relation(fields: [fleetId], references: [id])
    fleetId       String
    Alerts        Alerts[]
    VehicleStatus VehicleStatus[]
    Telemetry     Telemetry[]
}

enum EngineStatus {
    ON
    OFF
    IDLE
}

model Telemetry {
    id             Int          @id @default(autoincrement())
    coordsLon      Int
    coordsLat      Int
    speed          Int
    engine         EngineStatus
    fuel           Int
    odometer       Int
    diagnosticCode Int?
    timestamp      DateTime     @default(now())
    vehicle        Vehicle      @relation(fields: [vehicleId], references: [id])
    vehicleId      Int
}

enum Alert {
    SPEED_VIOLATION
    LOW_FUEL
}

model Alerts {
    id        Int     @id @default(autoincrement())
    type      Alert
    fleet     Fleet   @relation(fields: [fleetId], references: [id])
    fleetId   String
    vehicle   Vehicle @relation(fields: [vehicleId], references: [id])
    vehicleId Int
}

model VehicleStatus {
    vehicle    Vehicle  @relation(fields: [vehicleId], references: [id])
    vehicleId  Int      @unique
    lastSpeed  Int
    lastFuel   Int
    lastDriven DateTime @default(now())
}
