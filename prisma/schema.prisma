generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum RegistrationStatus {
    ACTIVE
    MAINTENANCE
    DECOMMISSIONED
}

model Fleet {
    id      Int       @id
    Vehicle Vehicle[]
    Alerts  Alerts[]
}

model Vehicle {
    id            Int                @id
    manufacturer  String
    model         String
    owner         String
    registration  RegistrationStatus
    fleet         Fleet              @relation(fields: [fleetId], references: [id])
    fleetId       Int
    Alerts        Alerts[]
    VehicleStatus VehicleStatus[]
}

model VehicleStatus {
    vehicle   Vehicle  @relation(fields: [vehicleId], references: [id])
    vehicleId Int      @unique
    updated   DateTime
}

enum EngineStatus {
    ON
    OFF
    IDLE
}

model Telemetry {
    id             Int          @id
    coordsLon      Int
    coordsLat      Int
    speed          Int
    engine         EngineStatus
    fuel           Int
    odometer       Int
    diagnosticCode Int?
    timestamp      DateTime
}

enum Alert {
    SPEED_VIOLATION
    LOW_FUEL
}

model Alerts {
    id        Int     @id
    type      Alert
    fleet     Fleet   @relation(fields: [fleetId], references: [id])
    fleetId   Int
    vehicle   Vehicle @relation(fields: [vehicleId], references: [id])
    vehicleId Int
}
